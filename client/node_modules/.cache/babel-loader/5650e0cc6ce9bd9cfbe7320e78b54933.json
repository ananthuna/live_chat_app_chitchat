{"ast":null,"code":"import _toConsumableArray from\"/home/ananthu/Desktop/chat-app/client/chat-app-react-frondend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/home/ananthu/Desktop/chat-app/client/chat-app-react-frondend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useContext,useEffect,useRef,useState}from'react';import{Box,Stack}from'@mui/system';import AdminNavbar from'../components/AdminHeader';import ChatHeader from'../components/ChatHeader';import SideBar from'../components/SideBar';import ChatBody from'../components/ChatBody';import ChatFooter from'../components/ChatFooter';import axios from'../axios';import{UserContext}from'../Context/Context';import{ChatIDContext}from'../Context/ChatIDContext';import{baseUrl}from'../url';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Chatpage(_ref){var socket=_ref.socket;var _useContext=useContext(UserContext),setImageURL=_useContext.setImageURL;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),messages=_useState2[0],setMessages=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),message=_useState4[0],setMessage=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),user=_useState6[0],setUser=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),typingStatus=_useState8[0],setTypingStatus=_useState8[1];var lastMessageRef=useRef(null);var _useContext2=useContext(ChatIDContext),chatID=_useContext2.chatID;var _useContext3=useContext(UserContext),userId=_useContext3.userId,setUserId=_useContext3.setUserId;useEffect(function(){axios.get(\"\".concat(baseUrl,\"/auth\"),{withCredentials:true}).then(function(response){if(response.data.loginGranted){setUser(response.data.user.firstName);setUserId(response.data.user._id);setImageURL(response.data.user.imageUrl);socket.on(userId,function(_ref2){var content=_ref2.content;setMessage(content);console.log('start');// console.log(messages.includes(content));\nconsole.log('end');setMessages(function(messages){return[].concat(_toConsumableArray(messages),[content]);});});}});},[socket]);useEffect(function(){var _lastMessageRef$curre;// ðŸ‘‡ï¸ scroll to bottom every time messages change\n(_lastMessageRef$curre=lastMessageRef.current)===null||_lastMessageRef$curre===void 0?void 0:_lastMessageRef$curre.scrollIntoView({behavior:'smooth'});console.log(messages);},[messages]);useEffect(function(){// send typing status to backend using socket.io\nsocket.on('typingResponse',function(data){return setTypingStatus(data);});},[socket]);return/*#__PURE__*/_jsx(Box,{children:/*#__PURE__*/_jsxs(Stack,{direction:\"row\",justifyContent:\"space-between\",children:[chatID?/*#__PURE__*/_jsxs(Box,{sx:{width:{xs:\"100%\",sm:'35%',md:\"25%\"},display:{xs:\"none\",sm:\"block\"}},children:[/*#__PURE__*/_jsx(AdminNavbar,{socket:socket,user:user}),/*#__PURE__*/_jsx(SideBar,{socket:socket,useradmin:user,message:message})]}):/*#__PURE__*/_jsxs(Box,{sx:{width:{xs:\"100%\",sm:'40%',md:\"25%\"},display:{xs:\"block\"}},children:[/*#__PURE__*/_jsx(AdminNavbar,{socket:socket,user:user}),/*#__PURE__*/_jsx(SideBar,{socket:socket,useradmin:user,message:message})]}),chatID?/*#__PURE__*/_jsxs(Box,{sx:{width:{xs:'100%',sm:'65%',md:\"75%\"}},children:[/*#__PURE__*/_jsx(ChatHeader,{}),/*#__PURE__*/_jsx(ChatBody,{user:user,messages:messages,lastMessageRef:lastMessageRef,typingStatus:typingStatus}),/*#__PURE__*/_jsx(ChatFooter,{user:user,userId:userId,socket:socket})]}):/*#__PURE__*/_jsxs(Box,{sx:{display:{xs:\"none\",sm:\"block\"},width:'75%'},children:[/*#__PURE__*/_jsx(ChatHeader,{}),/*#__PURE__*/_jsx(ChatBody,{user:user,messages:messages,lastMessageRef:lastMessageRef,typingStatus:typingStatus}),/*#__PURE__*/_jsx(ChatFooter,{user:user,userId:userId,socket:socket})]})]})});}export default Chatpage;","map":{"version":3,"names":["React","useContext","useEffect","useRef","useState","Box","Stack","AdminNavbar","ChatHeader","SideBar","ChatBody","ChatFooter","axios","UserContext","ChatIDContext","baseUrl","Chatpage","socket","setImageURL","messages","setMessages","message","setMessage","user","setUser","typingStatus","setTypingStatus","lastMessageRef","chatID","userId","setUserId","get","withCredentials","then","response","data","loginGranted","firstName","_id","imageUrl","on","content","console","log","current","scrollIntoView","behavior","width","xs","sm","md","display"],"sources":["/home/ananthu/Desktop/chat-app/client/chat-app-react-frondend/src/pages/Chatpage.js"],"sourcesContent":["import React, { useContext, useEffect, useRef, useState } from 'react'\nimport { Box, Stack } from '@mui/system'\nimport AdminNavbar from '../components/AdminHeader'\nimport ChatHeader from '../components/ChatHeader'\nimport SideBar from '../components/SideBar'\nimport ChatBody from '../components/ChatBody'\nimport ChatFooter from '../components/ChatFooter'\nimport axios from '../axios'\nimport { UserContext } from '../Context/Context'\nimport { ChatIDContext } from '../Context/ChatIDContext';\nimport { baseUrl } from '../url'\n\n\nfunction Chatpage({ socket }) {\n  const { setImageURL } = useContext(UserContext)\n  const [messages, setMessages] = useState([])\n  const [message, setMessage] = useState()\n  const [user, setUser] = useState(null)\n  const [typingStatus, setTypingStatus] = useState('')\n  const lastMessageRef = useRef(null);\n  const { chatID } = useContext(ChatIDContext)\n  const { userId, setUserId } = useContext(UserContext)\n\n  useEffect(() => {\n\n    axios.get(`${baseUrl}/auth`, { withCredentials: true }).then((response) => {\n      if (response.data.loginGranted) {\n        setUser(response.data.user.firstName)\n        setUserId(response.data.user._id)\n        setImageURL(response.data.user.imageUrl)\n        socket.on(userId, ({ content }) => {\n          setMessage(content)\n          console.log('start');\n          // console.log(messages.includes(content));\n          console.log('end');\n          setMessages(messages => ([...messages, content]))\n          \n        })\n      }\n    })\n  }, [socket])\n\n  useEffect(() => {\n    // ðŸ‘‡ï¸ scroll to bottom every time messages change\n    lastMessageRef.current?.scrollIntoView({ behavior: 'smooth' });\n    console.log(messages);\n  }, [messages]);\n\n  useEffect(() => {\n    // send typing status to backend using socket.io\n    socket.on('typingResponse', (data) => setTypingStatus(data));\n  }, [socket]);\n\n  return (\n    <Box >\n      <Stack direction=\"row\" justifyContent=\"space-between\">\n        {chatID ? (<Box sx={{ width: { xs: \"100%\", sm: '35%', md: \"25%\" }, display: { xs: \"none\", sm: \"block\" } }}>\n          <AdminNavbar socket={socket} user={user} />\n          <SideBar socket={socket} useradmin={user} message={message} />\n        </Box>)\n          :\n          (<Box sx={{ width: { xs: \"100%\", sm: '40%', md: \"25%\" }, display: { xs: \"block\" } }}>\n            <AdminNavbar socket={socket} user={user} />\n            <SideBar socket={socket} useradmin={user} message={message} />\n          </Box>)\n        }\n        {chatID ?\n          (<Box sx={{ width: { xs: '100%', sm: '65%', md: \"75%\" }, }} >\n            <ChatHeader />\n            <ChatBody user={user} messages={messages} lastMessageRef={lastMessageRef} typingStatus={typingStatus} />\n            <ChatFooter user={user} userId={userId} socket={socket} />\n          </Box>)\n          :\n          (<Box sx={{ display: { xs: \"none\", sm: \"block\" }, width: '75%', }} >\n            <ChatHeader />\n            <ChatBody user={user} messages={messages} lastMessageRef={lastMessageRef} typingStatus={typingStatus} />\n            <ChatFooter user={user} userId={userId} socket={socket} />\n          </Box>)\n        }\n      </Stack>\n    </Box>\n  )\n}\n\nexport default Chatpage\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}